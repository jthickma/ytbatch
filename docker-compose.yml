services:
  ytbatch-web:
    build:
      context: ./web
    container_name: ytbatch-web
    restart: unless-stopped
    ports:
      - "8899:5000"
    volumes:
      - ./data/input:/input
      - ./data/downloads:/downloads
      - ./data/queue:/queue
    environment:
      - FLASK_ENV=production
      - PYTHONUNBUFFERED=1
    # Remove depends_on here
    # depends_on:
    #   - ytbatch-worker
    networks:
      - ytbatch-network

  ytbatch-worker:
    build:
      context: ./worker
    container_name: ytbatch-worker
    restart: unless-stopped
    volumes:
      - ./data/input:/input
      - ./data/downloads:/downloads
      - ./data/queue:/queue
    environment:
      - YTBATCH_POLL_INTERVAL=2
      - MAX_CONCURRENT_DOWNLOADS=3
      - PYTHONUNBUFFERED=1
    depends_on:
      - ytbatch-web # Keep depends_on here
    networks:
      - ytbatch-network

networks:
  ytbatch-network:
    driver: bridge